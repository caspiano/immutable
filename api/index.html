<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.26.1">


<link href="css/style.css" rel="stylesheet" type="text/css">

<script type="text/javascript" src="js/doc.js"></script>
<script type="text/javascript">
  CrystalDoc.base_path = "";
</script>

  <meta id="repository-name" content="github.com/lucaong/immutable">
  <title>README - github.com/lucaong/immutable</title>
</head>
<body>

<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="repository-links">
      <a href="index.html">README</a>
    </div>
  </div>

  <div class="search-results" class="hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="github.com/lucaong/immutable/Immutable" data-name="immutable">
      <a href="Immutable.html">Immutable</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/lucaong/immutable/Immutable/Map" data-name="immutable::map(k, v)">
      <a href="Immutable/Map.html">Map</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/lucaong/immutable/Immutable/Map/Transient" data-name="immutable::map::transient(k, v)">
      <a href="Immutable/Map/Transient.html">Transient</a>
      
        <ul>
  
  <li class=" " data-id="github.com/lucaong/immutable/Immutable/Map/Transient/Invalid" data-name="immutable::map::transient::invalid">
      <a href="Immutable/Map/Transient/Invalid.html">Invalid</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/lucaong/immutable/Immutable/Map/Trie" data-name="immutable::map::trie(k, v)">
      <a href="Immutable/Map/Trie.html">Trie</a>
      
        <ul>
  
  <li class=" " data-id="github.com/lucaong/immutable/Immutable/Map/Trie/Entry" data-name="immutable::map::trie::entry(k, v)">
      <a href="Immutable/Map/Trie/Entry.html">Entry</a>
      
    </li>
  
  <li class=" " data-id="github.com/lucaong/immutable/Immutable/Map/Trie/EntryIterator" data-name="immutable::map::trie::entryiterator(k, v)">
      <a href="Immutable/Map/Trie/EntryIterator.html">EntryIterator</a>
      
    </li>
  
  <li class=" " data-id="github.com/lucaong/immutable/Immutable/Map/Trie/Values" data-name="immutable::map::trie::values(k, v)">
      <a href="Immutable/Map/Trie/Values.html">Values</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
  <li class="parent " data-id="github.com/lucaong/immutable/Immutable/Vector" data-name="immutable::vector(t)">
      <a href="Immutable/Vector.html">Vector</a>
      
        <ul>
  
  <li class="parent " data-id="github.com/lucaong/immutable/Immutable/Vector/Transient" data-name="immutable::vector::transient(t)">
      <a href="Immutable/Vector/Transient.html">Transient</a>
      
        <ul>
  
  <li class=" " data-id="github.com/lucaong/immutable/Immutable/Vector/Transient/Invalid" data-name="immutable::vector::transient::invalid">
      <a href="Immutable/Vector/Transient/Invalid.html">Invalid</a>
      
    </li>
  
</ul>

      
    </li>
  
  <li class=" " data-id="github.com/lucaong/immutable/Immutable/Vector/Trie" data-name="immutable::vector::trie(t)">
      <a href="Immutable/Vector/Trie.html">Trie</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<p><a href="https://travis-ci.org/lucaong/immutable" target="_blank"><img src="https://travis-ci.org/lucaong/immutable.svg?branch=master" alt="Build Status"/></a></p>

<h1>Immutable</h1>

<p>Efficient, thread-safe immutable data structures for Crystal.</p>

<p>Whenever an <code><a href="Immutable.html">Immutable</a></code> data structure is "modified", the original remains
unchanged and a modified copy is returned. However, the copy is efficient due to
structural sharing. This makes <code><a href="Immutable.html">Immutable</a></code> data structures inherently
thread-safe, garbage collector friendly and performant.</p>

<p>At the moment, <code><a href="Immutable.html">Immutable</a></code> implements the following persistent data structures:</p>

<ul><li><code><a href="Immutable/Vector.html">Immutable::Vector</a></code>: array-like ordered, integer-indexed collection
  implementing efficient append, pop, update and lookup operations</li><li><code><a href="Immutable/Map.html">Immutable::Map</a></code>: hash-like unordered key-value collection implementing
  efficient lookup and update operations</li></ul></ul>

<h2>Installation</h2>

<p>Add this to your application's <code>shard.yml</code>:</p>

<pre><code class="language-yaml">dependencies:
  immutable:
    github: lucaong/immutable</code></pre>

<h2>Usage</h2>

<p>For a list of all classes and methods refer to the <a href="http://lucaong.github.io/immutable/api/" target="_blank">API documentation</a></p>

<p>To use the immutable collections, require <code>immutable</code> in your code:</p>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;immutable&quot;</span></code></pre>

<h3>Vector (<a href="http://lucaong.github.io/immutable/api/Immutable/Vector.html" target="_blank">API docs</a>)</h3>

<pre><code class="language-crystal"><span class="c"># Vector behaves mostly like an Array:</span>
vector <span class="o">=</span> <span class="t">Immutable</span><span class="t">::</span><span class="t">Vector</span>[<span class="n">1</span>, <span class="n">2</span>, <span class="n">3</span>, <span class="n">4</span>, <span class="n">5</span>]  <span class="c"># =&gt; Vector [1, 2, 3, 4, 5]</span>
vector[<span class="n">0</span>]                                  <span class="c"># =&gt; 1</span>
vector[<span class="n">-1</span>]                                 <span class="c"># =&gt; 5</span>
vector.size                                <span class="c"># =&gt; 5</span>
vector.each { <span class="o">|</span>elem<span class="o">|</span> puts elem }

<span class="c"># Updating a Vector always returns a modified copy:</span>
vector2 <span class="o">=</span> vector.set(<span class="n">2</span>, <span class="n">0</span>)                 <span class="c"># =&gt; Vector [1, 2, 0, 4, 5]</span>
vector2 <span class="o">=</span> vector2.push(<span class="n">42</span>)                 <span class="c"># =&gt; Vector [1, 2, 0, 4, 5, 42]</span>

<span class="c"># The original vector is unchanged:</span>
vector                                     <span class="c"># =&gt; Vector [1, 2, 3, 4, 5]</span>

<span class="c"># Bulk updates can be made faster by using `transient`:</span>
vector3 <span class="o">=</span> vector.transient <span class="k">do</span> <span class="o">|</span>v<span class="o">|</span>
  <span class="n">1000</span>.times { <span class="o">|</span>i<span class="o">|</span> v <span class="o">=</span> v.push(i) }
<span class="k">end</span></code></pre>

<h3>Map (<a href="http://lucaong.github.io/immutable/api/Immutable/Map.html" target="_blank">API docs</a>)</h3>

<pre><code class="language-crystal"><span class="c"># Map behaves mostly like a Hash:</span>
map <span class="o">=</span> <span class="t">Immutable</span><span class="t">::</span><span class="t">Map</span>[{<span class="n">:a</span> => <span class="n">1</span>, <span class="n">:b</span> => <span class="n">2</span> }]  <span class="c"># =&gt; Map {:a =&gt; 1, :b =&gt; 2}</span>
map[<span class="n">:a</span>]                                  <span class="c"># =&gt; 1</span>

<span class="c"># Updating a Map always returns a modified copy:</span>
map2 <span class="o">=</span> map.set(<span class="n">:c</span>, <span class="n">3</span>)                      <span class="c"># =&gt; Map {:a =&gt; 1, :b =&gt; 2, :c =&gt; 3}</span>
map2 <span class="o">=</span> map2.delete(<span class="n">:b</span>)                     <span class="c"># =&gt; Map {:a =&gt; 1, :c =&gt; 3}</span>

<span class="c"># The original map in unchanged:</span>
map                                        <span class="c"># =&gt; Map {:a =&gt; 1, :b =&gt; 2}</span>

<span class="c"># Bulk updates can be made faster by using `transient`:</span>
map3 <span class="o">=</span> <span class="t">Immutable</span><span class="t">::</span><span class="t">Map</span>(<span class="t">String</span>, <span class="t">Int32</span>)<span class="o">[]</span>
map3 <span class="o">=</span> map3.transient <span class="k">do</span> <span class="o">|</span>m<span class="o">|</span>
  <span class="n">1000</span>.times { <span class="o">|</span>i<span class="o">|</span> m <span class="o">=</span> m.set(i.to_s, i) }
<span class="k">end</span></code></pre>

<h3>Nested structures</h3>

<pre><code class="language-crystal"><span class="c"># Nested arrays/hashes can be turned into immutable versions with the `.from`</span>
<span class="c"># method:</span>

nested <span class="o">=</span> <span class="t">Immutable</span>.from({<span class="n">:name</span> => <span class="s">&quot;Ada&quot;</span>, <span class="n">:colors</span> => [<span class="n">:blue</span>, <span class="n">:green</span>, <span class="n">:red</span>] })
nested <span class="c"># =&gt; Map {:name =&gt; &quot;Ada&quot;, :colors =&gt; Vector [:blue, :green, :red]}</span></code></pre>

<h2>Implementation</h2>

<p><code><a href="Immutable/Vector.html">Immutable::Vector</a></code> is implemented as a bit-partitioned vector trie with a block
size of 32 bits, that guarantees O(Log32) lookups and updates, which is
effectively constant time for practical purposes. Due to tail optimization,
appends and pop are O(1) 31 times out of 32, and O(Log32) 1/32 of the times.</p>

<p><code><a href="Immutable/Map.html">Immutable::Map</a></code> uses a bit-partitioned hash trie with a block size of 32 bits,
that also guarantees O(Log32) lookups and updates.</p>

<h2>Contributing</h2>

<ol><li>Fork it ( https://github.com/lucaong/immutable/fork )</li><li>Create your feature branch (git checkout -b my-new-feature)</li><li>Commit your changes (git commit -am 'Add some feature')</li><li>Push to the branch (git push origin my-new-feature)</li><li>Create a new Pull Request</li></ol>

<h2>Contributors</h2>

<ul><li><a href="https://github.com/lucaong" target="_blank">lucaong</a> Luca Ongaro - creator, maintainer</li></ul>

<h2>Acknowledgement</h2>

<p>Although not a port, this project takes inspiration from similar libraries and
persistent data structure implementations like:</p>

<ul><li><a href="http://clojure.org/reference/data_structures" target="_blank">Clojure persistent collections</a></li><li><a href="https://github.com/hamstergem/hamster" target="_blank">The Hamster gem for Ruby</a></li></ul></ul>

<p>When researching on the topic of persistent data structure implementation, these
blog posts have been of great help:</p>

<ul><li><a href="http://hypirion.com/musings/understanding-persistent-vector-pt-1" target="_blank">Understanding Clojure's Persistent Vector</a> (also <a href="http://hypirion.com/musings/understanding-persistent-vector-pt-2" target="_blank">Part 2</a>, <a href="http://hypirion.com/musings/understanding-persistent-vector-pt-3" target="_blank">Part 3</a> and <a href="http://hypirion.com/musings/understanding-clojure-transients" target="_blank">Understanding Clojure's Transients</a>)</li><li><a href="http://blog.higher-order.net/2009/09/08/understanding-clojures-persistenthashmap-deftwice.html" target="_blank">Understanding Clojure's Persistent Hash Map</a></li></ul></ul>

<p>Big thanks to their authors for the great job explaining the internals of these
data structures.</p>
</div>
</body>
</html>
